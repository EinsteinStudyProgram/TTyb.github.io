<!DOCTYPE html>
<html>

<head>

    <link rel="shortcut icon" href="/static/jpg/myjpg.jpg"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

    <!-- Stylesheets -->
    <link href="/static/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="/static/css/font-awesome.min.css" rel="stylesheet"/>
	<link href="/static/css/styles.css" rel="stylesheet"/>

    <script type="text/javascript" src="/static/js/jquery.min.js"></script>
    <script type="text/javascript" src="/static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="/static/js/modernizr.js"></script>
    <script type="text/javascript" src="/static/js/prefixfree.min.js"></script>
    <title>百哥么么哒|个人网站</title>

</head>


<body>
    <div class="navbar navbar-default navbar-fixed-top">
    <div class="container">
        <a class="navbar-brand brand" href="/">TTyb|个人网站</a>
        <div style="font-size: 6px;font-family: serif;text-decoration: none;">
            <ul class="nav navbar-nav">
                <li><a class="navbar-brand" href="/">首页</a></li>
                <li><a class="navbar-brand" href="/topic">文章</a></li>
                <li><a class="navbar-brand" href="/category">分类</a></li>
                <li><a class="navbar-brand" href="/log/log">日志</a></li>
                <li><a class="navbar-brand" href="/guestbook">留言</a></li>
            </ul>
        </div>

        <div class="pull-right">
            <div style="font-size: 4px;font-family: serif;">
                <ul class="nav navbar-nav">
                    <li>
                        <a href="/contact" class="navbar-brand">联系方式</a>
                    </li>
                    <li>
                        <a data-toggle="dropdown" class="dropdown-toggle navbar-brand" href="#">友情链接<strong
                                class="caret"></strong></a>
                        <ul class="dropdown-menu container-fluid" style="border-radius: 6px 6px 6px 6px;">
                            <li><a href="http://www.cnblogs.com/TTyb">TTyb博客园</a></li>
                            <li><a href="http://www.cnblogs.com/nima">一只尼玛博客园</a></li>
                            <li><a href="https://github.com/TTyb">TTybGithub</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>

    </div>
</div>

        <div class="container">
    <div class="page-header">
        <hr>
        <h3>Amazonz验证码机器算法识别</a></h3>
        <small>
            分类：机器学习
        </small>
        <h6 class="text-muted">作者:TTyb&nbsp;&nbsp;文章发表于 2016-12-10</h6>
        <br/>
        <p class="content text-overflow">
            <p>在破解Amazon的验证码的时候，利用机器学习得到验证码破解精度超过70%，主要是训练样本不够，如果在足够的样本下达到90%是非常有可能的。
update后，样本数为2800多，破解精度达到90%以上，perfect!</p>

<h3 id="文档结构为">文档结构为</h3>
<div class="highlighter-rouge"><pre class="highlight"><code>-- iconset1
   -- ...
-- jpg
   -- img
   -- jpg
      -- ...
   -- error.txt
-- py
   -- crack.py
</code></pre>
</div>

<h3 id="需要的库">需要的库</h3>
<p><code class="highlighter-rouge">pip3 install pillow</code> or <code class="highlighter-rouge">easy_install Pillow</code></p>

<h3 id="必须文件下载地址">必须文件下载地址</h3>
<p><a href="https://github.com/TTyb/AmazonCaptcha">Amazon验证码识别</a></p>

<blockquote>
  <p>1.读取图片，打印图片的结构直方图</p>
</blockquote>

<p>遍历出所有的jpg文件，</p>

<div class="highlighter-rouge"><pre class="highlight"><code>import os

# 找出文件夹下所有xml后缀的文件
def listfiles(rootdir, prefix='.xml'):
    file = []
    for parent, dirnames, filenames in os.walk(rootdir):
        if parent == rootdir:
            for filename in filenames:
                if filename.endswith(prefix):
                    file.append(rootdir + filename)
            return file
        else:
            pass


if __name__ == '__main__':
    path = "../jpg/img/"
    jpgname = listfiles(path, "jpg")

</code></pre>
</div>
<p>jpgname为一个数组，将文件夹中的jpg文件全部遍历出来</p>
<div class="highlighter-rouge"><pre class="highlight"><code>['../jpg/img/056567f5e15f8d5f46bc5e07905009fd.jpg', '../jpg/img/05796993cf0a3c779b6fe83db2a27ac3.jpg', '../jpg/img/073847b62252c63829850cb1bd49601e.jpg', '../jpg/img/07aafc4694264509135490b85630aaf5.jpg', '../jpg/img/07d126e49e42143e0d21a0dafd522ac8.jpg', '../jpg/img/07dbfd0bd41d11e9475a96bc724e9f56.jpg', '../jpg/img/07fb8e7163e2ebd36e90c209502051ed.jpg', '../jpg/img/08ff7dc78f348ad7e4309eda9588a5f5.jpg', '../jpg/img/09dc3340f3c4a77c61cd18da7b3eca82.jpg', '../jpg/img/0b354ba9e9a132075fcc3dff6f517106.jpg', '../jpg/img/0bdca69fec2089cfaa46b458f5e483c3.jpg', '../jpg/img/0d0b1d778e00a1c84001d5838b9f5ef1.jpg', '../jpg/img/0d14f8838c30f6b54f266d9eb02e1b93.jpg', '../jpg/img/0e8d3e12d36d39314acfcd3bb8c3970a.jpg',...]
</code></pre>
</div>

<p>读取图片，得到图片的结构直方图</p>

<div class="highlighter-rouge"><pre class="highlight"><code>from PIL import Image

for item in jpgname:
    newjpgname = []
    im = Image.open(item)
    print(item)
    # jpg不是最低像素，gif才是，所以要转换像素
    im = im.convert("P")

    # 打印像素直方图
    his = im.histogram()
</code></pre>
</div>

<p>像素直方图打印结果为
<code class="highlighter-rouge">[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 2, 1, 0, 0, 0, 2, 0, 0, 0, 0, 1, 0, 1, 1, 0, 0, 1, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 2, 0, 0, 0, 1, 2, 0, 1, 0, 0, 1, 0, 2, 0, 0, 1, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 3, 1, 3, 3, 0, 0, 0, 0, 0, 0, 1, 0, 3, 2, 132, 1, 1, 0, 0, 0, 1, 2, 0, 0, 0, 0, 0, 0, 0, 15, 0, 1, 0, 1, 0, 0, 8, 1, 0, 0, 0, 0, 1, 6, 0, 2, 0, 0, 0, 0, 18, 1, 1, 1, 1, 1, 2, 365, 115, 0, 1, 0, 0, 0, 135, 186, 0, 0, 1, 0, 0, 0, 116, 3, 0, 0, 0, 0, 0, 21, 1, 1, 0, 0, 0, 2, 10, 2, 0, 0, 0, 0, 2, 10, 0, 0, 0, 0, 1, 0, 625]</code></p>

<p>该数组长度为255，每一个元素代表（0-255）颜色的多少，例如最后一个元素为625，即255（代表的是白色）最多，组合在一起</p>

<div class="highlighter-rouge"><pre class="highlight"><code>values = {}
for i in range(0, 256):
    values[i] = his[i]

# 排序，x:x[1]是按照括号内第二个字段进行排序,x:x[0]是按照第一个字段
temp = sorted(values.items(), key=lambda x: x[1], reverse=True)
# print(temp)
</code></pre>
</div>

<p>打印结果为
<code class="highlighter-rouge">[(255, 625), (212, 365), (220, 186), (219, 135), (169, 132), (227, 116), (213, 115), (234, 21), (205, 18), (184, 15), (241, 10), (248, 10), (191, 8), (198, 6), (155, 3), (157, 3), (158, 3), (167, 3), (228, 3), (56, 2), (67, 2), (91, 2), (96, 2), (109, 2), (122, 2), (127, 2), (134, 2), (140, 2), (168, 2), (176, 2), (200, 2), (211, 2), (240, 2), (242, 2), (247, 2), (43, 1), (44, 1), (53, 1), (61, 1), (68, 1), (79, 1), (84, 1), (92, 1), (101, 1), (103, 1), (104, 1), (107, 1), (121, 1), (126, 1), (129, 1), (132, 1), (137, 1), (149, 1), (151, 1), (153, 1), (156, 1), (165, 1), (170, 1), (171, 1), (175, 1), (186, 1), (188, 1), (192, 1), (197, 1), (206, 1), (207, 1), (208, 1), (209, 1), (210, 1), (215, 1), (223, 1), (235, 1), (236, 1), (253, 1), (0, 0), (1, 0), (2, 0), (3, 0), (4, 0), (5, 0), (6, 0), (7, 0), (8, 0), (9, 0), (10, 0), (11, 0), (12, 0), (13, 0), (14, 0), (15, 0), (16, 0), (17, 0), (18, 0), (19, 0), (20, 0), (21, 0), (22, 0), (23, 0), (24, 0), (25, 0), (26, 0), (27, 0), (28, 0), (29, 0), (30, 0), (31, 0), (32, 0), (33, 0), (34, 0), (35, 0), (36, 0), (37, 0), (38, 0), (39, 0), (40, 0), (41, 0), (42, 0), (45, 0), (46, 0), (47, 0), (48, 0), (49, 0), (50, 0), (51, 0), (52, 0), (54, 0), (55, 0), (57, 0), (58, 0), (59, 0), (60, 0), (62, 0), (63, 0), (64, 0), (65, 0), (66, 0), (69, 0), (70, 0), (71, 0), (72, 0), (73, 0), (74, 0), (75, 0), (76, 0), (77, 0), (78, 0), (80, 0), (81, 0), (82, 0), (83, 0), (85, 0), (86, 0), (87, 0), (88, 0), (89, 0), (90, 0), (93, 0), (94, 0), (95, 0), (97, 0), (98, 0), (99, 0), (100, 0), (102, 0), (105, 0), (106, 0), (108, 0), (110, 0), (111, 0), (112, 0), (113, 0), (114, 0), (115, 0), (116, 0), (117, 0), (118, 0), (119, 0), (120, 0), (123, 0), (124, 0), (125, 0), (128, 0), (130, 0), (131, 0), (133, 0), (135, 0), (136, 0), (138, 0), (139, 0), (141, 0), (142, 0), (143, 0), (144, 0), (145, 0), (146, 0), (147, 0), (148, 0), (150, 0), (152, 0), (154, 0), (159, 0), (160, 0), (161, 0), (162, 0), (163, 0), (164, 0), (166, 0), (172, 0), (173, 0), (174, 0), (177, 0), (178, 0), (179, 0), (180, 0), (181, 0), (182, 0), (183, 0), (185, 0), (187, 0), (189, 0), (190, 0), (193, 0), (194, 0), (195, 0), (196, 0), (199, 0), (201, 0), (202, 0), (203, 0), (204, 0), (214, 0), (216, 0), (217, 0), (218, 0), (221, 0), (222, 0), (224, 0), (225, 0), (226, 0), (229, 0), (230, 0), (231, 0), (232, 0), (233, 0), (237, 0), (238, 0), (239, 0), (243, 0), (244, 0), (245, 0), (246, 0), (249, 0), (250, 0), (251, 0), (252, 0), (254, 0)]</code></p>

<p>将占比最多的10个颜色筛选出来</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 占比最多的10种颜色
for j, k in temp[:10]:
    print(j, k)
    # 255 12177
    # 0 772
    # 254 94
    # 1 40
    # 245 10
    # 12 9
    # 236 9
    # 243 9
    # 2 8
    # 6 8
# 255是白底，0是黑色，可以打印来看看0和254

</code></pre>
</div>

<blockquote>
  <p>2.构造新的无杂质图片</p>
</blockquote>

<p>生成一张白底啥都没有的图片</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 获取图片大小，生成一张白底255的图片
im2 = Image.new("P", im.size, 255)

</code></pre>
</div>

<p>利用上一步占比最多的颜色可以看出，255是白底，0是黑色，可以打印来看看0和254</p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161210180057460-992618058.jpg" alt="" /></p>

<p>最后证明0是黑色字母，254是斑点，可以舍弃！</p>

<p>将这些颜色根据宽和高的坐标以此写入新生成的白底照片中</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 获取图片大小，生成一张白底255的图片
im2 = Image.new("P", im.size, 255)
for y in range(im.size[1]):
    # 获得y坐标
    for x in range(im.size[0]):

        # 获得坐标(x,y)的RGB值
        pix = im.getpixel((x, y))

        # 这些是要得到的数字
        # 事实证明只要0就行，254是斑点
        if pix == 0:
            # 将黑色0填充到im2中
            im2.putpixel((x, y), 0)
            # 生成了一张黑白二值照片
            # im2.show()
</code></pre>
</div>

<p><code class="highlighter-rouge">黑白二值照片</code></p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161210180352226-30674119.png" alt="" /></p>

<blockquote>
  <p>3.切割图片</p>
</blockquote>

<p><strong>x代表图片的宽，y代表图片的高</strong>
对图片进行纵向切割</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 纵向切割
# 找到切割的起始和结束的横坐标
inletter = False
foundletter = False
start = 0
end = 0

letters = []

for x in range(im2.size[0]):
    for y in range(im2.size[1]):
        pix = im2.getpixel((x, y))
        if pix != 255:
            inletter = True
    if foundletter == False and inletter == True:
        foundletter = True
        start = x

    if foundletter == True and inletter == False:
        foundletter = False
        end = x
        letters.append((start, end))

    inletter = False
</code></pre>
</div>
<p>打印结果为
<code class="highlighter-rouge"># [(27, 47), (48, 71), (73, 101), (102, 120), (122, 147), (148, 166)]</code></p>

<p>(27, 47)代表从x=27到x=47纵向切割成一条状</p>

<p>保存字段到本地，这里就是<code class="highlighter-rouge">training_samples.py</code>文件里面的内容，为的就是生成训练样本，这里生成的样本有2800多！</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 保存切割下来的字段
count = 0
for letter in letters:
    # (切割的起始横坐标，起始纵坐标，切割的宽度，切割的高度)
    im3 = im2.crop((letter[0], 0, letter[1], im2.size[1]))
    # 随机生成0-10000的数字
    a = random.randint(0, 10000)
    # 更改成用时间命名
    im3.save("../jpg/letter/%s.gif" % (time.strftime('%Y%m%d%H%M%S', time.localtime()) + str(a)))
    count += 1
</code></pre>
</div>

<p>字段样式</p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161210180921601-563964655.png" alt="" /></p>

<blockquote>
  <p>4.训练识别</p>
</blockquote>

<p>使用的是 <strong>AI与向量空间图像识别</strong>
<code class="highlighter-rouge">将标准图片转换成向量坐标a，需要识别的图片字段为向量坐标b，cos(a,b)值越大说明夹角越小，越接近重合</code></p>

<p>空间两向量计算公式</p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161209092720663-899187747.png" alt="" />
<img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161209093023944-1652411562.png" alt="" /></p>

<p>编写的夹角公式为</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 夹角公式
import math

class VectorCompare:
    # 计算矢量大小
    # 计算平方和
    def magnitude(self, concordance):
        total = 0
        # concordance.iteritems:报错'dict' object has no attribute 'iteritems'
        # concordance.items()
        for word, count in concordance.items():
            total += count ** 2
        return math.sqrt(total)

    # 计算矢量之间的 cos 值
    def relation(self, concordance1, concordance2):
        topvalue = 0
        # concordance1.iteritems:报错'dict' object has no attribute 'iteritems'
        # concordance1.items()
        for word, count in concordance1.items():
            # if concordance2.has_key(word):报错'dict' object has no attribute 'has_key'
            # 改成word in concordance2
            if word in concordance2:
                # 计算相乘的和
                topvalue += count * concordance2[word]
        return topvalue / (self.magnitude(concordance1) * self.magnitude(concordance2))
</code></pre>
</div>

<p>转换验证码图片为向量：</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 将图片转换为矢量
def buildvector(im):
    d1 = {}
    count = 0
    for i in im.getdata():
        d1[count] = i
        count += 1
    return d1
</code></pre>
</div>

<p>打印结果
<code class="highlighter-rouge"><span class="p">{</span><span class="err">0:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">1:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">2:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">3:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">4:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">5:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">6:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">7:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">8:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">9:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">10:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">11:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">12:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">13:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">14:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">15:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">16:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">17:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">18:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">19:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">20:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">21:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">22:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">23:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">24:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">25:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">26:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">27:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">28:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">29:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">30:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">31:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">32:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">33:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">34:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">35:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">36:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">37:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">38:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">39:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">40:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">41:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">42:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">43:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">44:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">45:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">46:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">47:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">48:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">49:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">50:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">51:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">52:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">53:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">54:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">55:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">56:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">57:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">58:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">59:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">60:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">61:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">62:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">63:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">64:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">65:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">66:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">67:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">68:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">69:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">70:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">71:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">72:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">73:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">74:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">75:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">76:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">77:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">78:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">79:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">80:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">81:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">82:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">83:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">84:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">85:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">86:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">87:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">88:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">89:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">90:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">91:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">92:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">93:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">94:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">95:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">96:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">97:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">98:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">99:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">100:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">101:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">102:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">103:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">104:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">105:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">106:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">107:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">108:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">109:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">110:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">111:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">112:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">113:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">114:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">115:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">116:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">117:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">118:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">119:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">120:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">121:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">122:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">123:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">124:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">125:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">126:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">127:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">128:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">129:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">130:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">131:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">132:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">133:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">134:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">135:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">136:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">137:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">138:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">139:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">140:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">141:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">142:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">143:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">144:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">145:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">146:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">147:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">148:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">149:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">150:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">151:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">152:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">153:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">154:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">155:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">156:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">157:</span><span class="w"> </span><span class="err">0,</span><span class="w"> </span><span class="err">158:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">159:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">160:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">161:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">162:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">163:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">164:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">165:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">166:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">167:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">168:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">169:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">170:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">171:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">172:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">173:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">174:</span><span class="w"> </span><span class="err">255,</span><span class="w"> </span><span class="err">175:</span><span class="w"> </span><span class="err">255</span><span class="p">}</span></code></p>

<p>加载训练集，且把训练集也变成向量</p>

<div class="highlighter-rouge"><pre class="highlight"><code>v = VectorCompare()
iconset = ['a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k',
           'l', 'm', 'n', 'o', 'p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z']
import os

imageset = []
for letter in iconset:
    for img in os.listdir('../iconset1/%s/' % (letter)):
        temp = []
        if img != "Thumbs.db" and img != ".DS_Store":
            temp.append(buildvector(Image.open("../iconset1/%s/%s" % (letter, img))))
        imageset.append({letter: temp})
</code></pre>
</div>

<p><strong>开始识别验证码</strong></p>

<div class="highlighter-rouge"><pre class="highlight"><code># 开始破解训练
count = 0
for letter in letters:
    # (切割的起始横坐标，起始纵坐标，切割的宽度，切割的高度)
    im3 = im2.crop((letter[0], 0, letter[1], im2.size[1]))

    guess = []
    # 将切割得到的验证码小片段与每个训练片段进行比较
    for image in imageset:
        for x, y in image.items():
            if len(y) != 0:
                guess.append((v.relation(y[0], buildvector(im3)), x))

    # 排序选出夹角最小的（即cos值最大）的向量，夹角越小则越接近重合，匹配越接近
    guess.sort(reverse=True)
    print("", guess[0])
</code></pre>
</div>

<p>排序选出夹角最小的（即cos值最大）的向量，夹角越小则越接近重合，匹配越接近</p>

<div class="highlighter-rouge"><pre class="highlight"><code>guess.sort(reverse=True)
print("", guess[0])
count += 1
</code></pre>
</div>

<p>运行结果</p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161210181220476-477172006.png" alt="" /></p>

<p>结果显示前面是匹配度，后面是匹配的字母</p>

<p>将图片的名字改成识别后的名字</p>

<div class="highlighter-rouge"><pre class="highlight"><code># 得到拼接后的验证码识别图像
newname = str("".join(newjpgname))
os.rename(item, path + newname + ".jpg")
</code></pre>
</div>
<p>效果为</p>

<p><img src="http://images2015.cnblogs.com/blog/996148/201612/996148-20161210181420382-2045061934.png" alt="" /></p>

<p>完整源码在<a href="https://github.com/TTyb/AmazonCaptcha">TTyb</a></p>

<p>更多学习请看<a href="http://www.cnblogs.com/TTyb/p/6144740.html">python3验证码机器学习</a></p>

        </p>
    </div>
    <!-- 多说评论框 start -->
<div class="ds-thread" data-thread-key="http://localhost:4000/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Amazonz%E9%AA%8C%E8%AF%81%E7%A0%81%E6%9C%BA%E5%99%A8%E7%AE%97%E6%B3%95%E8%AF%86%E5%88%AB.html"
     data-title="Amazonz验证码机器算法识别" data-url="http://localhost:4000/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/Amazonz%E9%AA%8C%E8%AF%81%E7%A0%81%E6%9C%BA%E5%99%A8%E7%AE%97%E6%B3%95%E8%AF%86%E5%88%AB.html"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"ttyb"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();

</script>
<!-- 多说公共JS代码 end -->

</div>


    
<a class="gototop" title="返回顶部" target="_self" href="#"></a>
<div class="container">
    <div id="footer" class="text-muted">
        <div style="font-family: 'Lato', sans-serif;">
            <div class="foo">
                <span class="letter" data-letter="T">T</span>
                <span class="letter" data-letter="T">T</span>
                <span class="letter" data-letter="y">y</span>
                <span class="letter" data-letter="b">b</span>
            </div>
        </div>
        <h3 style="font-size: 1.2em;font-family: KaiTi;">无聊就想打码 打码使我快乐</h3>
        <div style="font-size: 1.2em;font-family: KaiTi;">
            不用多久<br/>
            我就会升职加薪<br/>
            当上总经理<br/>
            出任CEO<br/>
            迎娶白富美<br/>
            走上人生巅峰
        </div>
    </div>
</div>
<footer id="footer">
    <ul class="icons">
        <li><a href="/contact" class="icon fa-qq"><span class="label">QQ</span></a></li>
        <li><a href="https://github.com/TTyb" class="icon fa-github"><span class="label">Github</span></a></li>
        <li><a href="/" class="icon fa-home"><span class="label">首页</span></a></li>
        <li><a href="http://www.cnblogs.com/TTyb/" class="icon fa-heart"><span class="label">博客园</span></a></li>
        <li><a href="/cloud" class="icon fa-cloud"><span class="label">云世界</span></a></li>
        <li><a href="/404" class="icon fa-map-signs"><span class="label">404</span></a></li>
    </ul>
    <p class="copyright">Copyright &copy; TTyb All rights reserved.</p>
</footer>

<script type="text/javascript" src="/static/js/jquery.gototop.min.js"></script>
<script type="text/javascript">
    $(function(){
            // $(".gototop").gototop();
            $(".gototop").gototop({
                position : 0,
                duration : 1250,
                visibleAt : 300,
                classname : "isvisible"
            });
        });
</script>


</body>
</html>
