---
layout: post
categories: [crawler]
title: 抓取图片
date: 2117-05-12
author: TTyb
desc: "3.抓取图片"
showdate: 2017-05-12
---

上文读者应该已经学会怎么提取自己想要的文本信息出来了，那么如何抓取自己需要的图片呢？

例如抓取首页的轮播图 [http://www.tybai.com/](http://www.tybai.com/) ：

>1. 打开谷歌浏览器按 `F12` ,点击箭头
>2. 箭头选中某一张图片，点击
>3. 鼠标箭头悬浮在 `jpg` 的地方


按照上面步骤可以得到如下图形：

<span style="text-align:center"><img  src="/img/crawler3/result1.jpg"/></span>

这样可以看到红色箭头指向的图片的 `url` 为 `http://www.tybai.com/static/jpg/1.jpg`

在浏览器地址栏里面输入这个网址：

<span style="text-align:center"><img  src="/img/crawler3/result2.jpg"/></span>

这样就对了！那么我们看一下 `html` 里面是怎么写的，按照 [第一章](http://www.tybai.com/crawler/1_%E5%88%9D%E8%AF%86%E7%88%AC%E8%99%AB.html) 的方法得到图片所在的 `html` 为：

```
<script type="text/javascript">
var posterTvGrid = new posterTvGrid('posterTvGrid',{className: "posterTvGrid"},[
		{"img":"static\/jpg\/1.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/2.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/3.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/4.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/5.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/6.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/7.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/8.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/9.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/10.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
		{"img":"static\/jpg\/11.jpg","title":"百哥么么哒","url":"https:\/\/ttyb.github.io\/"},
	]
);
</script>
```

很明显这是作者用 `js` 调用的图片，而且 `img` 的 `url` 少了字段 `http://www.tybai.com/` 以及多了字段 `\` ，这里可以将其 `url` 拼接起来，这里我们先将 `img` 的 `url` 抓取下来，正则表达式的写法：

```
# 正则表达式
def reg(html):
    reg = r'({"img":")(.+?)(","title)'
    all = re.compile(reg)
    alllist = re.findall(all, html)
    return alllist
```

返回的样式为：

```
[('{"img":"', 'static\\/jpg\\/1.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/2.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/3.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/4.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/5.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/6.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/7.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/8.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/9.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/10.jpg', '","title'), ('{"img":"', 'static\\/jpg\\/11.jpg', '","title')]
```

这里写个 `for` 就可以得到里面的 `imgurl` ：

```
imgurls = reg(html)
print(imgurls)

for imgurl in imgurls:
    print(imgurl[1])
```

得到样式：

```
static\/jpg\/1.jpg
static\/jpg\/2.jpg
static\/jpg\/3.jpg
static\/jpg\/4.jpg
static\/jpg\/5.jpg
static\/jpg\/6.jpg
static\/jpg\/7.jpg
static\/jpg\/8.jpg
static\/jpg\/9.jpg
static\/jpg\/10.jpg
static\/jpg\/11.jpg
```

在 `python` 中有个函数是 `replace` ，可以替换字符串中的某个字符，我们将 `\` 替换成空 `""` 就行：

```
for imgurl in imgurls:
    print(imgurl[1].replace("\\", ""))
```

得到 `img` 的 `url` ：

```
static/jpg/1.jpg
static/jpg/2.jpg
static/jpg/3.jpg
static/jpg/4.jpg
static/jpg/5.jpg
static/jpg/6.jpg
static/jpg/7.jpg
static/jpg/8.jpg
static/jpg/9.jpg
static/jpg/10.jpg
static/jpg/11.jpg
```

将其拼接起来：

```
"http://www.tybai.com/" + imgurl[1].replace("\\", "")
```

最终终于得到我们想要的图片 `url` 啦，那么就是下载下来就好，下载其实和获取网页 `html` 差不多的写法：

```
urllib.request.urlopen(imgurl).read()
```

主要是要保存在本地，这里是保存到 `E` 盘，那么如下写法：

```
saveimg = open("E:/" + str(imgname) + ".jpg", 'wb')
saveimg.write(urllib.request.urlopen(imgurl).read())
saveimg.close()
```

打开 `E` 盘，以 `wb` 的方式保存名字为 `imgname.jpg` 的图片，为了防止图片重名，这里以加一的方式命名：

```
imgname = 1
imgname += 1
```

即图片的名字为依次为 ： `1.jpg` , `2.jpg` , ... ，代码为：

```
# 图片名字
imgname = 1
for imgurl in imgurls:
    saveimg = open("E:/" + str(imgname) + ".jpg", 'wb')
    newimgurl = "http://www.tybai.com/" + imgurl[1].replace("\\", "")
    print(newimgurl)
    saveimg.write(urllib.request.urlopen(newimgurl).read())
    imgname += 1
    saveimg.close()
```

完美下载：

<span style="text-align:center"><img  src="/img/crawler3/result3.jpg"/></span>

# 练习

```
用 BeautifulSoup 和 lxml 两种方法抓取首页 百哥么么哒 头像
```

<span style="text-align:center"><img  src="/img/crawler3/result4.jpg"/></span>

# 源码

<a href="/code/crawler3/crawler3.py" target="_blank">crawler3.py</a>

<a href="/code/crawler3/answer.py" target="_blank">练习答案</a>